import{a as g,d as u}from"./firebase-config-Zcj99KW5.js";/* empty css              *//* empty css                  */import{onAuthStateChanged as ge,signOut as fe}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";import{onSnapshot as z,doc as w,query as j,collection as v,where as P,orderBy as ve,limit as we,getDoc as G,updateDoc as I,addDoc as h,getDocs as Ie,serverTimestamp as Ee}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";import"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";const U=document.getElementById("user-display-name"),K=document.getElementById("sidebar-avatar"),se=document.getElementById("user-initial"),he=document.getElementById("total-balance"),k=document.getElementById("transactions-body"),Be=document.getElementById("logout-btn"),_=document.getElementById("greeting-msg");ge(g,async n=>{n?(se.textContent=n.email[0].toUpperCase(),U&&(U.textContent=n.email),await Y(n.uid),await W(n.uid),be(n.uid),ue()):window.location.href="login.html"});let A,$;function Y(n){A&&A(),A=z(w(u,"users",n),t=>{if(t.exists()){const e=t.data(),a=p(e.balance||0);he.textContent=a;const o=document.getElementById("history-total-balance");o&&(o.textContent=a);const s=e.username||e.email;U&&(U.textContent=s),e.photoURL&&(K.src=e.photoURL,K.style.display="block",se.style.display="none");const r=document.getElementById("username");if(r&&document.getElementById("profile-section").style.display==="none"){e.username&&(r.value=e.username),e.dob&&(document.getElementById("dob").value=e.dob),e.defaultCrypto&&(document.getElementById("default-crypto").value=e.defaultCrypto),e.defaultWallet&&(document.getElementById("default-wallet").value=e.defaultWallet);const c=document.getElementById("withdraw-wallet");c&&!c.value&&(e.defaultCrypto&&(document.getElementById("withdraw-method").value=e.defaultCrypto),e.defaultWallet&&(c.value=e.defaultWallet)),e.photoURL&&(document.getElementById("profile-preview").src=e.photoURL,document.getElementById("profile-preview").style.display="block",document.getElementById("profile-placeholder").style.display="none")}const d=document.getElementById("kyc-status"),i=e.kycStatus||"Unverified";d&&(d.textContent=i,d.style.color=i==="Verified"?"var(--success)":i==="Pending"?"var(--warning)":"var(--error)"),window.currentUserKYCStatus=i,ue(s)}else console.log("No such user document!")},t=>{console.error("Error getting user document:",t)})}function W(n){$&&$();const t=j(v(u,"transactions"),P("userId","==",n),ve("date","desc"),we(10));$=z(t,e=>{if(k.innerHTML="",e.empty){k.innerHTML='<tr><td colspan="4" style="text-align: center; color: var(--text-gray);">No transactions found.</td></tr>';return}e.forEach(a=>{const o=a.data(),s=new Date(o.date).toLocaleDateString();let r=`<span class="status-badge status-${o.status.toLowerCase()}">${o.status}</span>`;o.status==="Pending"&&o.type==="deposit"&&(r+=' <button onclick="showPendingDetails()" style="background: none; border: none; padding: 0; margin-left: 5px; cursor: pointer; color: var(--primary-color); text-decoration: underline; font-size: 0.8rem;">Read More</button>');const d=`
                <tr class="transaction-row">
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="width: 32px; height: 32px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i data-lucide="${o.type.includes("in")||o.type==="deposit"?"arrow-down-left":"arrow-up-right"}" style="width: 16px;"></i>
                            </div>
                            ${ie(o.type)}
                        </div>
                    </td>
                    <td style="font-weight: 600;">${p(o.amount)}</td>
                    <td>${r}</td>
                    <td style="color: var(--text-gray);">${s}</td>
                </tr>
            `;k.innerHTML+=d}),lucide.createIcons()},e=>{console.error("Error fetching transactions:",e),e.code==="failed-precondition"?k.innerHTML='<tr><td colspan="4" style="text-align: center; color: var(--warning);">Setup Required: Check Console for Index Link</td></tr>':k.innerHTML=`<tr><td colspan="4" style="text-align: center; color: var(--error);">${e.message}</td></tr>`})}let S=[],F;function be(n){F&&F();const t=j(v(u,"investments"),P("userId","==",n),P("status","==","Active"));F=z(t,e=>{S=[],e.forEach(d=>{S.push({id:d.id,...d.data()})});const a=S.length;re();const o=document.getElementById("active-investments");o&&(o.textContent=a);const s=document.getElementById("active-plans-container"),r=document.getElementById("active-plans-grid");a>0?(s.style.display="block",r.innerHTML="",e.forEach(d=>{const i=d.data(),c=new Date(i.startDate),y=new Date(i.endDate),l=new Date,m=y-c,B=l-c,b=Math.ceil((y-l)/(1e3*60*60*24)),D=Math.max(0,Math.min(100,B/m*100)),q=`
                    <div class="stat-card" style="border: 1px solid var(--success);">
                        <div class="stat-header">
                            <span class="stat-title" style="color: var(--success);">${i.planName}</span>
                            <span style="font-size: 0.75rem; background: rgba(190, 242, 100, 0.2); color: var(--success); padding: 2px 8px; border-radius: 12px;">Active</span>
                        </div>
                        <div class="stat-value" style="font-size: 1.5rem;">${p(i.amount)}</div>
                        <div class="stat-change" style="margin-top: 0.5rem; width: 100%; display: block;">
                            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 4px;">
                                <span>ROI: ${i.roi}%</span>
                                <span>${b} days left</span>
                            </div>
                            <div style="width: 100%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px;">
                                <div style="width: ${D}%; height: 100%; background: var(--success); border-radius: 2px;"></div>
                            </div>
                        </div>
                    </div>
                `;r.innerHTML+=q})):s.style.display="none"},e=>{console.error("Error fetching investments:",e)})}function re(){let n=0;const t=new Date;S.forEach(o=>{const s=new Date(o.startDate),r=new Date(o.endDate);let d;o.roi<10?d=o.roi:d=(o.roi||100)/100;const i=o.amount*(d-1);if(t>=r)n+=i;else if(t>s){const c=r-s,l=(t-s)/c;n+=i*l}});const e=document.getElementById("total-profit"),a=document.getElementById("history-total-profit");e&&(e.textContent=p(n)),a&&(a.textContent=p(n)),console.log(`Profits updated: ${p(n)} at ${t.toLocaleTimeString()}`)}window.profitInterval=setInterval(re,10*60*1e3);function p(n){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n)}function ie(n){return n.charAt(0).toUpperCase()+n.slice(1)}Be.addEventListener("click",async()=>{try{await fe(g),window.location.href="index.html"}catch(n){console.error("Error signing out:",n)}});window.showDepositModal=()=>{document.getElementById("deposit-modal").classList.add("active")};window.closeDepositModal=()=>{document.getElementById("deposit-modal").classList.remove("active")};document.querySelectorAll(".menu-item").forEach(n=>{n.addEventListener("click",t=>{t.preventDefault();const e=n.getAttribute("data-page");if(e==="deposit"){showDepositModal();return}document.querySelectorAll(".menu-item").forEach(s=>s.classList.remove("active")),n.classList.add("active"),document.querySelectorAll(".content-wrapper").forEach(s=>s.style.display="none");const a=e+"-section",o=document.getElementById(a);o&&(o.style.display="block",document.getElementById("page-title").textContent=ie(e))})});var te;(te=document.getElementById("withdraw-form"))==null||te.addEventListener("submit",async n=>{n.preventDefault();const t=parseFloat(document.getElementById("withdraw-amount").value),e=document.getElementById("withdraw-method").value,a=document.getElementById("withdraw-wallet").value,o=g.currentUser;if(!(!o||!t||!a))try{const r=(await G(w(u,"users",o.uid))).data().balance||0;if(t>r){alert("Insufficient balance.");return}const d=r-t;await I(w(u,"users",o.uid),{balance:d}),await h(v(u,"transactions"),{userId:o.uid,type:"withdraw",amount:t,status:"Pending",method:e,walletAddress:a,date:new Date().toISOString()}),alert("Withdrawal request submitted."),Y(o.uid),W(o.uid),document.getElementById("withdraw-form").reset()}catch(s){console.error("Withdraw error:",s),alert("Error processing withdrawal.")}});var ne;(ne=document.getElementById("transfer-form"))==null||ne.addEventListener("submit",async n=>{n.preventDefault();const t=document.getElementById("transfer-email").value,e=parseFloat(document.getElementById("transfer-amount").value),a=g.currentUser;if(!(!a||!e||!t)){if(t===a.email){alert("Cannot transfer to yourself.");return}try{const o=j(v(u,"users"),P("email","==",t)),s=await Ie(o);if(s.empty){alert("User not found.");return}const r=s.docs[0],d=w(u,"users",a.uid),c=(await G(d)).data().balance||0;if(e>c){alert("Insufficient balance.");return}await I(d,{balance:c-e}),await I(r.ref,{balance:(r.data().balance||0)+e}),await h(v(u,"transactions"),{userId:a.uid,type:"transfer_out",amount:e,to:t,status:"Completed",date:new Date().toISOString()}),await h(v(u,"transactions"),{userId:r.id,type:"transfer_in",amount:e,from:a.email,status:"Completed",date:new Date().toISOString()}),alert("Transfer successful!"),Y(a.uid),W(a.uid),document.getElementById("transfer-form").reset()}catch(o){console.error("Transfer error:",o),alert("Transfer failed. Please try again.")}}});function N(n,t=800){return new Promise((e,a)=>{const o=new FileReader;o.onload=s=>{const r=new Image;r.onload=()=>{const d=document.createElement("canvas");let i=r.width,c=r.height;i>t&&(c=t/i*c,i=t),d.width=i,d.height=c,d.getContext("2d").drawImage(r,0,0,i,c),e(d.toDataURL("image/jpeg",.6))},r.onerror=()=>a("Failed to load image for compression."),r.src=s.target.result},o.onerror=()=>a("Failed to read file."),o.readAsDataURL(n)})}function De(n){return new Promise((t,e)=>{const a=new FileReader;a.onload=()=>t(a.result),a.onerror=o=>e(o),a.readAsDataURL(n)})}let f,H=[];window.recordedVideoBlob=null;let x;const de=document.createElement("style");de.textContent=`
    @keyframes pulse {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.2); opacity: 0.5; }
        100% { transform: scale(1); opacity: 1; }
    }
`;document.head.appendChild(de);async function ke(){try{x=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480},audio:!0});const n=document.getElementById("kyc-preview");n.srcObject=x,document.getElementById("start-camera-btn").style.display="none",document.getElementById("start-record-btn").style.display="inline-block"}catch(n){console.error("Camera error:",n),alert("Could not access camera. Please ensure you have given permission in your browser settings.")}}function xe(){H=[];const n={mimeType:"video/webm;codecs=vp8,opus",videoBitsPerSecond:15e4};MediaRecorder.isTypeSupported(n.mimeType)||delete n.mimeType,f=new MediaRecorder(x,n),f.ondataavailable=t=>{t.data.size>0&&H.push(t.data)},f.onstop=async()=>{window.recordedVideoBlob=new Blob(H,{type:"video/webm"}),document.getElementById("record-success-msg").style.display="block",document.getElementById("recording-indicator").style.display="none",x&&x.getTracks().forEach(t=>t.stop())},f.start(),document.getElementById("recording-indicator").style.display="block",document.getElementById("start-record-btn").style.display="none",document.getElementById("stop-record-btn").style.display="inline-block",setTimeout(()=>{f&&f.state==="recording"&&ce()},5e3)}function ce(){f&&f.state==="recording"&&f.stop(),document.getElementById("stop-record-btn").style.display="none"}document.addEventListener("click",n=>{n.target.id==="start-camera-btn"&&ke(),n.target.id==="start-record-btn"&&xe(),n.target.id==="stop-record-btn"&&ce()});document.getElementById("deposit-form").addEventListener("submit",async n=>{n.preventDefault();const t=parseFloat(document.getElementById("deposit-amount").value),e=document.getElementById("deposit-method").value,a=document.getElementById("deposit-proof");if(!g.currentUser||!t)return;if(a.files.length===0){alert("Please upload a screenshot of your payment to proceed.");return}const s=t>=5e3,r=window.currentUserKYCStatus!=="Verified",d=document.getElementById("kyc-front"),i=document.getElementById("kyc-back"),c=document.getElementById("kyc-fullname"),y=document.getElementById("kyc-country");let l=null;if(s&&r){if(!d.files[0]||!i.files[0]||!window.recordedVideoBlob||!c.value||!y.value){alert("Verification Required: Please provide your name, country, ID photos, and record a liveness video.");return}l={fullName:c.value,country:y.value,idType:document.getElementById("kyc-id-type").value,frontFile:d.files[0],backFile:i.files[0],videoBlob:window.recordedVideoBlob}}else if(s&&window.currentUserKYCStatus==="Pending"){alert("Your previous verification request is still pending review. Please wait for approval before making another large deposit.");return}try{closeDepositModal();const m=document.getElementById("success-modal");m.classList.add("active");const B=m.querySelector("h3"),b=m.querySelector("p");l?(B.textContent="Optimizing Documents...",b.textContent="Please wait while we prepare your identity files for secure submission. This only takes a moment."):(B.textContent="Processing...",b.textContent="Compressing proof and logging your request.");const D=g.currentUser;if(!D)throw new Error("No active session.");console.log("Optimizing payment proof...");const q=await N(a.files[0]);let R=null;if(l){console.log("Optimizing KYC documents and video...");const[C,ye,pe]=await Promise.all([N(l.frontFile),N(l.backFile),De(l.videoBlob)]);R={fullName:l.fullName,country:l.country,idType:l.idType,frontImg:C,backImg:ye,video:pe,status:"Pending",submittedAt:Ee()},await I(w(u,"users",D.uid),{kycStatus:"Pending",kycData:R})}const me={userId:D.uid,type:"deposit",amount:t,status:"Pending",method:e,proofImage:q,date:new Date().toISOString(),requiresKYC:!!R};await h(v(u,"transactions"),me),console.log("Deposit logged successfully."),B.textContent="Request Submitted",b.textContent="Your deposit and identity documents have been received and are now under review. Check the history tab for updates.",document.getElementById("deposit-form").reset(),document.getElementById("info-qr").src="",document.getElementById("deposit-info").style.display="none",setTimeout(()=>{const C=document.querySelector('.menu-item[data-page="history"]');C&&C.click()},3e3)}catch(m){console.error("Submission error:",m),alert("Verification failed: "+m.message),document.getElementById("success-modal").classList.remove("active")}});window.closeSuccessModal=()=>{document.getElementById("success-modal").classList.remove("active")};window.showPendingDetails=()=>{document.getElementById("success-modal").classList.add("active")};const Ce={btc:{address:"bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh",label:"Bitcoin (BTC)"},eth:{address:"0x71C7656EC7ab88b098defB751B7401B5f6d8976F",label:"Ethereum (ETH)"},usdt:{address:"T9yD14Nj9j7xAB4dbGeiX9h8yuqlmfGhjx",label:"Tether (USDT TRC20)"},sol:{address:"H7937H7g8e2s3df4f5g6h7j8k9l0m1n2o3p4q5r6s",label:"Solana (SOL)"},doge:{address:"D8H7937H7g8e2s3df4f5g6h7j8k9l0m1n2o3p4q",label:"Dogecoin (DOGE)"},ltc:{address:"L7937H7g8e2s3df4f5g6h7j8k9l0m1n2o3p4q",label:"Litecoin (LTC)"}},T=document.getElementById("deposit-method"),Q=document.getElementById("deposit-info"),Le=document.getElementById("info-coin"),le=document.getElementById("info-address"),Se=document.getElementById("info-qr");function Te(){const n=T.value,t=Ce[n];t?(Q.style.display="block",Le.textContent=t.label,le.textContent=t.address,Se.src=`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${t.address}`):Q.style.display="none"}const E=document.getElementById("copy-btn");E==null||E.addEventListener("click",()=>{const n=le.textContent;n!=="Loading..."&&navigator.clipboard.writeText(n).then(()=>{const t=E.innerHTML;E.innerHTML='<i data-lucide="check" style="width: 18px; margin: 0; color: var(--success);"></i>',lucide.createIcons(),setTimeout(()=>{E.innerHTML=t,lucide.createIcons()},2e3)})});T==null||T.addEventListener("change",Te);const L=document.getElementById("deposit-amount"),X=document.getElementById("kyc-fields"),J=document.getElementById("kyc-notice");L==null||L.addEventListener("input",()=>{const t=(parseFloat(L.value)||0)>=5e3,e=window.currentUserKYCStatus!=="Verified";t&&e?(X.style.display="block",J.style.display="block",document.getElementById("kyc-front").required=!0,document.getElementById("kyc-back").required=!0):(X.style.display="none",J.style.display="none",document.getElementById("kyc-front").required=!1,document.getElementById("kyc-back").required=!1)});const Z=window.showDepositModal;window.showDepositModal=()=>{document.getElementById("kyc-fields")&&(document.getElementById("kyc-fields").style.display="none"),document.getElementById("kyc-notice")&&(document.getElementById("kyc-notice").style.display="none"),window.recordedVideoBase64=null,document.getElementById("record-success-msg")&&(document.getElementById("record-success-msg").style.display="none"),document.getElementById("start-camera-btn")&&(document.getElementById("start-camera-btn").style.display="inline-block"),document.getElementById("start-record-btn")&&(document.getElementById("start-record-btn").style.display="none"),document.getElementById("stop-record-btn")&&(document.getElementById("stop-record-btn").style.display="none"),document.getElementById("recording-indicator")&&(document.getElementById("recording-indicator").style.display="none"),document.getElementById("kyc-preview")&&(document.getElementById("kyc-preview").srcObject=null),Z&&Z()};const Me=[{name:"Cloud Node V1",min:1e3,max:5e3},{name:"Pro Mining Rig",min:5001,max:15e3},{name:"Data Center A1",min:15001,max:5e4},{name:"Quantum Farm",min:50001,max:1e5},{name:"Global Network",min:100001,max:35e4}];let O=0,V=0;window.openInvestModal=(n,t,e,a,o)=>{document.getElementById("invest-modal").classList.add("active"),document.getElementById("invest-plan-name").textContent=n;const s=a<10?Math.round(a*100):Math.round(a);document.getElementById("invest-plan-roi").textContent=s+"%",document.getElementById("invest-plan-days").textContent=o,document.getElementById("invest-min").textContent=p(t),document.getElementById("invest-max").textContent=p(e),O=t,V=e,document.getElementById("invest-roi").value=a,document.getElementById("invest-days").value=o;const r=document.getElementById("total-balance").textContent;document.getElementById("invest-balance-display").textContent=r};window.closeInvestModal=()=>{document.getElementById("invest-modal").classList.remove("active")};var oe;(oe=document.getElementById("invest-form"))==null||oe.addEventListener("submit",async n=>{n.preventDefault();const t=parseFloat(document.getElementById("invest-amount").value),e=document.getElementById("invest-plan-name").textContent,a=parseFloat(document.getElementById("invest-roi").value),o=parseInt(document.getElementById("invest-days").value),s=g.currentUser;if(!(!s||!t)){if(t<O||t>V){alert(`Amount must be between ${p(O)} and ${p(V)}`);return}try{const r=w(u,"users",s.uid),i=(await G(r)).data().balance||0;if(t>i){let y=`We sincerely apologize, but your current balance of ${p(i)} is insufficient for this purchase.

`;const l=Me.filter(m=>m.min<=i);l.length>0?(y+=`Based on your available funds, we recommend the following packages:
`,l.forEach(m=>{y+=`â€¢ ${m.name} ($${m.min.toLocaleString()} - $${m.max.toLocaleString()})
`}),y+=`
Please choose one of these plans or deposit more funds to proceed.`):y+=`You do not have enough funds for any investment plan at the moment.

Please visit the Deposit section to add funds to your wallet.`,alert(y);return}await I(r,{balance:i-t});const c=new Date;c.setDate(c.getDate()+o),await h(v(u,"investments"),{userId:s.uid,planName:e,amount:t,roi:a,expectedReturn:t*(a/100),startDate:new Date().toISOString(),endDate:c.toISOString(),status:"Active"}),await h(v(u,"transactions"),{userId:s.uid,type:"investment",amount:t,status:"Completed",description:`Purchased ${e}`,date:new Date().toISOString()}),closeInvestModal(),alert(`Successfully purchased ${e}!`)}catch(r){console.error("Investment failed:",r),alert("Transaction failed. Please try again.")}}});function ue(n){if(!_)return;const t=new Date().getHours();let e="Good morning";t>=12&&(e="Good afternoon"),t>=17&&(e="Good evening");const a=n||(g.currentUser?g.currentUser.email:"User");_.textContent=`${e}, ${a}`}const M=document.getElementById("profile-pic-input");M==null||M.addEventListener("change",n=>{const t=n.target.files[0];if(!t)return;if(t.size>500*1024){alert("Image too large. Max 500KB.");return}const e=new FileReader;e.onload=a=>{const o=document.getElementById("profile-preview"),s=document.getElementById("profile-placeholder");o.src=a.target.result,o.style.display="block",s.style.display="none"},e.readAsDataURL(t)});var ae;(ae=document.getElementById("profile-form"))==null||ae.addEventListener("submit",async n=>{n.preventDefault();const t=g.currentUser;if(!t)return;const e=document.getElementById("username").value,a=document.getElementById("dob").value,o=document.getElementById("default-crypto").value,s=document.getElementById("default-wallet").value,r=M.files[0];let d={username:e,dob:a,defaultCrypto:o,defaultWallet:s};if(r){const i=new FileReader;i.onloadend=async()=>{d.photoURL=i.result;try{await I(w(u,"users",t.uid),d),alert("Profile updated!")}catch(c){console.error("Profile save error:",c),alert("Error saving profile.")}},i.readAsDataURL(r)}else try{await I(w(u,"users",t.uid),d),alert("Profile updated!")}catch(i){console.error("Profile save error:",i),alert("Error saving profile.")}});const ee=document.querySelector(".plans-grid");if(ee){const n=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&(e.target.querySelectorAll(".plan-card").forEach(o=>o.classList.add("scrolled-in")),n.unobserve(e.target))})},{threshold:.2,rootMargin:"0px 0px -50px 0px"});n.observe(ee)}
